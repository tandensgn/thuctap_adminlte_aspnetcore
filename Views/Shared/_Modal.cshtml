@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@

<!--  EDIT MODAL -->
<div class="modal fade" id="modal-edit">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Edit </h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form id="edit-e" enctype="multipart/form-data" action="@Url.Action("EditEmployee","Home")" method="POST">
                <div class="modal-body">
                    <input type="text" hidden class="form-control" id="EmpId" name="EmpId">
                    <div class="form-group">
                        <label for="InputUsername">User Name</label>
                        <input type="text" class="form-control" id="EmpUsername" name="EmpUsername" placeholder="Enter User Name...">
                    </div>
                    <div hidden class="form-group">
                        <label for="InputPassword">Password</label>
                        <input type="password" class="form-control" id="EmpPass" name="EmpPass" placeholder="Password...">
                    </div>
                    <div class="form-group">
                        <label for="InputFullname">Full Name</label>
                        <input type="text" class="form-control" id="EmpFullname" name="EmpFullname" placeholder="Full Name...">
                    </div>
                    <div class="form-group">
                        <label for="InputEmail">Email</label>
                        <input type="email" class="form-control" id="EmpEmail" name="EmpEmail" placeholder="Email...">
                    </div>
                    <div class="form-group">
                        <label for="InputPhone">Phone Number</label>
                        <input type="text" class="form-control" id="EmpPhone" name="EmpPhone" placeholder="Phone Number...">
                    </div>
                    <div class="form-group">
                        <label>Address</label>
                        <textarea id="EmpAddress" name="EmpAddress" class="form-control" rows="2" placeholder="Enter Address..."></textarea>
                    </div>

                    <div class="row">
                        <div class="col-sm-12">
                            <div class="form-group">
                                <label for="InputAvatar">Avatar</label>
                                <div class="input-group">
                                    <div class="custom-file">
                                        <input type="file" class="custom-file-input" id="EmpAvatarStream" name="EmpAvatarStream">
                                        <label class="custom-file-label" for="InputFile">Choose file</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div hidden class="col-sm-6">
                            <div class="form-group">
                                <label>Status</label>
                                <select id="EmpStatus" name="EmpStatus" class="custom-select">
                                    <option>Active</option>
                                    <option>DeActive</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    @*<button type="submit" class="btn btn-primary " id="btn-edit">Save changes</button>*@
                    <button id="btn-edit" type="submit" class="btn btn-primary">
                        Save changes
                    </button>
                </div>
            </form>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->
<!-- POPUP MSG EDIT SUCCESS -->
<div class="modal fade" id="modal-default-edit-success">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Edit</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Edit successfully !</p>
            </div>
            <div class="modal-footer justify-content-end">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>





<!-- ADD MODAL -->
<div class="modal fade" id="modal-lg-add">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Add New</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form id="add-a" enctype="multipart/form-data" action="@Url.Action("AddEmployee","Home")" method="POST">
                <div class="modal-body">
                    <div class="card-body">

                        <input type="text" hidden class="form-control" id="EmpId" name="EmpId">
                        <div class="form-group">
                            <label for="InputUsername">User Name</label>
                            <input type="text" class="form-control" name="EmpUsername" placeholder="Enter User Name...">
                        </div>
                        <div class="form-group">
                            <label for="InputPassword">Password</label>
                            <input type="password" class="form-control" name="EmpPass" placeholder="Password...">
                        </div>
                        <div class="form-group">
                            <label for="InputFullname">Full Name</label>
                            <input type="text" class="form-control" name="EmpFullname" placeholder="Full Name...">
                        </div>
                        <div class="form-group">
                            <label for="InputEmail">Email</label>
                            <input type="email" class="form-control" name="EmpEmail" placeholder="Email...">
                        </div>
                        <div class="form-group">
                            <label for="InputPhone">Phone Number</label>
                            <input type="text" class="form-control" name="EmpPhone" placeholder="Phone Number...">
                        </div>
                        <div class="form-group">
                            <label>Address</label>
                            <textarea name="EmpAddress" class="form-control" rows="2" placeholder="Enter Address..."></textarea>
                        </div>

                        <div class="row">
                            <div class="col-sm-6">
                                <!-- text input -->
                                <div class="form-group">
                                    <label for="InputAvatar">Avatar</label>
                                    <div class="input-group">
                                        <div class="custom-file">
                                            <input type="file" class="custom-file-input" id="EmpAvatarStream" name="EmpAvatarStream">
                                            <label class="custom-file-label" for="InputFile">Choose file</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label>Status</label>
                                    <select id="EmpStatus" name="EmpStatus" class="custom-select">
                                        <option>Active</option>
                                        <option>DeActive</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button id="btn-add" type="submit" class="btn btn-primary">
                        Save
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- /.modal -->
<!-- POPUP MSG ADD SUCCESS -->
<div class="modal fade" id="modal-default-add-success">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Add</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Add successfully !</p>
            </div>
            <div class="modal-footer justify-content-end">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>





<!-- DELETE MODAL -->
<div class="modal fade" id="modal-delete">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Delete</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">
                <p>Are you sure to delete?</p>
            </div>
            <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                @*<button id="delete-d" type="submit" class="btn btn-primary">Delete</button>*@
                <button id="delete-d" type="submit" class="btn btn-primary">
                    Delete
                </button>
            </div>

        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->
<!-- POPUP MSG DELETE SUCCESS -->
<div class="modal fade" id="modal-sm-del-success">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Delete</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">
                <p>Delete Successfully !</p>
            </div>
            <div class="modal-footer justify-content-end">
                <button id="delete-d" type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>

        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->





<!-- PASSWORD MODAL -->
<div class="modal fade" id="modal-password">
        <div class="modal-dialog ">
            <div class="modal-content">

                <form id="password-p" enctype="multipart/form-data" action="@Url.Action("PasswordEmployee","Home")" method="POST">

                    <div class="modal-header">
                        <h4 class="modal-title">Change your password</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <input type="text" hidden class="form-control" id="Id" name="Id">
                        <div class="form-group row">
                            <label for="inputEmail" class="col-sm-4 col-form-label">New password</label>
                            <div class="col-sm-8">
                                <input type="password" class="form-control" id="newPassword" name="newPassword" placeholder="Password">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="inputEmail" class="col-sm-4 col-form-label">Confirm password</label>
                            <div class="col-sm-8">
                                <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" placeholder="Confirm password">
                            </div>
                        </div>



                    </div>
                    <div class="modal-footer justify-content-between">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button id="btn-password" type="submit" class="btn btn-primary">
                            Save changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>



<script>
    bsCustomFileInput.init();
    attachSort();
    function attachSort() {
        $("#example1").DataTable({
            "responsive": true,
            "autoWidth": false,
        });
    }

    // Modal
    $('#modal-edit').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget)
        var modal = $(this)
        //var
        var EmpId = button.data('id')
        var EmpUsername = button.data('username')
        var EmpFullname = button.data('fullname')
        var EmpEmail = button.data('email')
        var EmpPass = button.data('password')
        var EmpPhone = button.data('phone')
        var EmpAddress = button.data('address')
        var RoleName = button.data('rolename')
        var EmpStatus = button.data('status')
        var EmpAvatarStream = button.data('avatar')
        console.log(EmpId)
        console.log(EmpAvatarStream)
        //modal.find
        //modal.find('.modal-title').text('Edit')
        modal.find('.modal-body #EmpId').val(EmpId)
        modal.find('.modal-body #EmpUsername').val(EmpUsername)
        modal.find('.modal-body #EmpFullname').val(EmpFullname)
        modal.find('.modal-body #EmpEmail').val(EmpEmail)
        modal.find('.modal-body #EmpPass').val(EmpPass)
        modal.find('.modal-body #EmpPhone').val(EmpPhone)
        modal.find('.modal-body #EmpAddress').val(EmpAddress)
        modal.find('.modal-body #RoleName').val(RoleName)
        modal.find('.modal-body #EmpStatus').val(EmpStatus)
        modal.find('.modal-body #EmpAvatarStream').val(EmpAvatarStream)
    })
    $('#modal-password').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget)
        var modal = $(this)
        //var
        var EmpId = button.data('id')
        console.log(EmpId);
        var EmpPass = button.data('password')

        //modal.find
        modal.find('.modal-title').text('Password')
        modal.find('.modal-body #EmpId').val(EmpId)
        modal.find('.modal-body #EmpPass').val(EmpPass)
    })
    $('#modal-delete').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget)
        var id = button.data('id')
        console.log(id)
        var modal = $(this)
        modal.find('.modal-title').text('Delete')
        modal.find('.modal-footer #delete-d').data('id', id)
    })

    // Ajax
    $('#edit-e').submit(function (e) {
        e.preventDefault();
        $('#edit-e').validate({
            rules: {
                EmpEmail: {
                    required: true,
                    email: true,
                },
                EmpPass: {
                    required: true,
                    minlength: 6
                },
                EmpUsername: {
                    required: true,
                    minlength: 6
                },
                EmpFullname: {
                    required: true,
                },
                EmpPhone: {
                    required: true,
                    minlength: 10,
                    maxlength: 10,
                    digits: true
                },
                EmpAddress: {
                    required: true
                },

                EmpRole: {
                    required: true
                },
                EmpStatus: {
                    required: true
                }

            },
            messages: {
                EmpEmail: {
                    required: "Enter email",
                    email: "Enter the appropriate email"
                },
                EmpUsername: {
                    required: "Enter username",
                    minlength: "Username must be longer than 6 characters"
                },

                EmpPass: {
                    required: "Enter password",
                    minlength: "Passwords must be at least 6 characters"
                },
                EmpPhone: {
                    required: "Enter phone number",
                    minlength: "Phone numbers must have 10 valid numbers",
                    maxlength: "Phone numbers must have 10 valid numbers",
                    digits: "Phone numbers must have 10 valid numbers"
                },
                EmpAddress: {
                    required: "Enter address"
                },

                EmpStatus: {
                    required: "Choose status"
                },
                RoleName: {
                    required: "Choose role"
                },
                EmpFullname: {
                    required: "Enter fullname"
                }

            },
            errorElement: 'span',
            errorPlacement: function (error, element) {
                error.addClass('invalid-feedback');
                element.closest('.form-group').append(error);
            },
            highlight: function (element, errorClass, validClass) {
                $(element).addClass('is-invalid');
            },
            unhighlight: function (element, errorClass, validClass) {
                $(element).removeClass('is-invalid');
            }

        })
        if ($('#edit-e').valid()) {
            var data = new FormData(this);
            console.log(data.EmpId);
            $(".modal-footer #btn-edit").attr("disabled", true);

            $(".modal-footer #btn-edit").prepend('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>')

            $.ajax({
                url: this.action,
                type: this.method,
                data: data,
                cache: false,
                contentType: false,
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("XSRF-TOKEN",
                        $('input:hidden[name="__RequestVerificationToken"]').val());
                },
                processData: false,
                success: function (response) {

                    $('#em-list').html(response);
                    console.log(response);
                    attachSort();
                    $('.modal-footer #btn-edit').attr("disabled", false);
                    $('.modal-footer #btn-edit .spinner-border').remove()
                    hideModal();
                },
                error: function (xhr, error, status) {
                    Toast.fire({
                        icon: 'error',
                        title: 'Save Failed !'
                    })
                }
            });
        }

    });
    $('#password-p').submit(function (e) {
        e.preventDefault();
        $('#password-p').validate({
            rules: {
                EmpPass: {
                    required: true,
                    minlength: 6
                },
                EmpCofPass: {
                    required: true,
                    minlength: 6
                }
            },
            messages: {
                EmpPass: {
                    required: "Enter password",
                    minlength: "Passwords must be at least 6 characters"
                },
                EmpCofPass: {
                    required: "Enter password",
                    minlength: "Passwords didn't match "
                }
            },
            errorElement: 'span',
            errorPlacement: function (error, element) {
                error.addClass('invalid-feedback');
                element.closest('.form-group').append(error);
            },
            highlight: function (element, errorClass, validClass) {
                $(element).addClass('is-invalid');
            },
            unhighlight: function (element, errorClass, validClass) {
                $(element).removeClass('is-invalid');
            }

        })
        if ($('#password-p').valid()) {
            var data = new FormData(this);
            console.log(data.EmpId);
            $(".modal-footer #btn-password").attr("disabled", true);

            $(".modal-footer #btn-password").prepend('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>')

            $.ajax({
                url: this.action,
                type: this.method,
                data: data,
                cache: false,
                contentType: false,
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("XSRF-TOKEN",
                        $('input:hidden[name="__RequestVerificationToken"]').val());
                },
                processData: false,
                success: function (response) {

                    $('#em-list').html(response);
                    console.log(response);
                    attachSort();
                    $('.modal-footer #btn-password').attr("disabled", false);
                    $('.modal-footer #btn-password .spinner-border').remove()
                    hideModal();
                },
                error: function (xhr, error, status) {
                    Toast.fire({
                        icon: 'error',
                        title: 'Save Failed !'
                    })
                }
            });
        }

    });
    $('#add-a').submit(function (a) {
        a.preventDefault();
        $('#add-a').validate({
            rules: {
                EmpEmail: {
                    required: true,
                    email: true,
                },
                EmpPass: {
                    required: true,
                    minlength: 6
                },
                EmpUsername: {
                    required: true,
                    minlength: 6
                },
                EmpFullname: {
                    required: true,
                },
                EmpPhone: {
                    required: true,
                    minlength: 10,
                    maxlength: 10,
                    digits: true
                },
                EmpAddress: {
                    required: true
                },
                //EmpRole: {
                //    required: true
                //},
                EmpStatus: {
                    required: true
                },
                EmpAvatarStream: {
                    required: true
                }

            },
            messages: {
                EmpEmail: {
                    required: "Enter email",
                    email: "Enter the appropriate email"
                },
                EmpUsername: {
                    required: "Enter username",
                    minlength: "Username must be longer than 9 characters"
                },

                EmpPass: {
                    required: "Enter password",
                    minlength: "Passwords must be at least 6 characters"
                },
                EmpPhone: {
                    required: "Enter phone number",
                    minlength: "Phone numbers must have 10 valid numbers",
                    maxlength: "Phone numbers must have 10 valid numbers",
                    digits: "Phone numbers must have 10 valid numbers"
                },
                EmpAddress: {
                    required: "Enter address"
                },

                EmpStatus: {
                    required: "Choose status"
                },
                //EmpRole: {
                //    required: "Choose role"
                //},
                EmpFullname: {
                    required: "Enter fullname"
                },
                EmpAvatarStream: {
                    required: "Choose avatar"
                }

            },
            errorElement: 'span',
            errorPlacement: function (error, element) {
                error.addClass('invalid-feedback');
                element.closest('.form-group').append(error);
            },
            highlight: function (element, errorClass, validClass) {
                $(element).addClass('is-invalid');
            },
            unhighlight: function (element, errorClass, validClass) {
                $(element).removeClass('is-invalid');
            }

        });
        if ($('#add-a').valid()) {
            var data = new FormData(this);
            console.log(data.EmpId);
            $(".modal-footer #btn-add").attr("disabled", true);

            $(".modal-footer #btn-add").prepend('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>')

            $.ajax({
                url: this.action,
                type: this.method,
                data: data,
                cache: false,
                contentType: false,
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("XSRF-TOKEN",
                        $('input:hidden[name="__RequestVerificationToken"]').val());
                },
                processData: false,
                success: function (response) {

                    $('#em-list').html(response);

                    attachSort();
                    $('.modal-footer #btn-add').attr("disabled", false);
                    $('.modal-footer #btn-add .spinner-border').remove()
                    hideModal();

                    $(".modal-body input").val("");
                    //Toast.fire({
                    //    icon: 'success',
                    //    title: 'Save Successfully ! '
                    //})
                },
                error: function (xhr, error, status) {
                    console.log(error, status);
                }
            });
        }

    });
    $('#delete-d').click(function (d) {

        var id = $(this).data('id')
        $(".modal-footer #delete-emp").attr("disabled", true);

        $(".modal-footer #delete-emp").prepend('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>')

        $.ajax({
            url: "/Home/RemoveEmployee/" + id,
            type: "POST",

            cache: false,
            contentType: false,
            beforeSend: function (xhr) {
                xhr.setRequestHeader("XSRF-TOKEN",
                    $('input:hidden[name="__RequestVerificationToken"]').val());
            },
            processData: false,
            success: function (response) {

                $('#em-list').html(response);
                $(".modal-footer #delete-emp").attr("disabled", false);
                $('.modal-footer #delete-emp .spinner-border').remove()
                attachSort();
                hideModal();

                //Toast.fire({
                //    icon: 'success',
                //    title: 'Delete Successfully !'
                //})


            },
            error: function (xhr, error, status) {
                console.log(error, status);
            }
        });
    });



</script>
